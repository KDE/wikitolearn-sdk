#!/usr/bin/env python3
# -*- coding: utf-8 -*-
import os
import argcomplete, argparse
import yaml
from pprint import pprint

WTL_DEV_KIT_PATH = os.environ.get("WTL_DEV_KIT_PATH")
WTL_DEV_KIT_REPOS_PATH = os.environ.get("WTL_DEV_KIT_REPOS_PATH")
WTL_DEV_KIT_BIN_PATH = os.environ.get("WTL_DEV_KIT_BIN_PATH")

config = {}

with open(WTL_DEV_KIT_PATH + "/config/repositories.yml") as fh:
    config['repositories'] = yaml.load(fh)

parser = argparse.ArgumentParser()

def completer_service_name(prefix, **kwargs):
    options = []
    for option in config['repositories'].keys():
        if option[0:len(prefix)] == prefix:
            options.append(option)
    return options

parser.add_argument(
    'service_name',
    help='Service name',
    choices=list(config['repositories'].keys())
).completer = completer_service_name

argcomplete.autocomplete(parser)
args = parser.parse_args()

service_name = args.service_name

print("Running '{service_name}'".format(service_name=service_name))
print("Config:")
pprint(config['repositories'][service_name])
